{% extends 'layout.html.twig' %}

{% set current_navigation_id = 'venues' %}
{% block title %}Venues{% endblock %}

{% block body %}

<h3>Venues</h3>
<div class="map-large" id="map-main"></div>

<ul class="large-block-list" id="venues_list">
{% for venue in venues %}
   <li id="venue-{{ venue.slug }}" class="venue" data-latitude="{{ venue.latitude }}" data-longitude="{{ venue.longitude }}">
       <div class="row">
           <h5 class="venue-name"><a href="{{ path('get_venue', {identifier: venue.slug}) }}">{{ venue.name }}</a></h5>
           <div class="marker" title="Scoll map to this venue"><img src="{{ asset("build/images/marker-icon.png") }}" /></div>

           {%- if venue.college -%}
              <h6>{{ venue.college }} {{ venue.college == "Anglia Ruskin" ? "University" : "College" }}, Cambridge</h6>
           {%- elseif venue.address -%}
              <h6>{{ venue.address }}</h6>
           {%- endif -%}

           <p>
               {{- venue.description | strip_camdram_markdown | truncate(200) }}
               <span class="right">[<a href="{{ path('get_venue', {identifier: venue.slug}) }}">Read More</a>]</span>
           </p>
       </div>
   </li>
{% endfor %}
</ul>

{% endblock %}

{% block javascripts %}
<script>
    {#- begin-CSP-permitted-script -#}
    $(function() {
        var map = $('#map-main')
        map.venueMap()
        var markerUrl = map.venueMap('marker-url')

        $('.venue').each(function() {
            var $self = $(this)
            var marker = map.venueMap('add-marker', {
                'location': [$self.attr('data-latitude'), $self.attr('data-longitude')],
                'content': $self.find('.venue-name').html(),
            })
            $self.find('.marker').click(function() {
                map.venueMap('select-marker', {marker: marker})
            })
        })
    })
    {#- end-CSP-permitted-script -#}
</script>
{% endblock %}
{% block compiled_assets -%}
    {{ encore_entry_link_tags('venue') }}
    {{ encore_entry_script_tags('venue') }}
{%- endblock %}
